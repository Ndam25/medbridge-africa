<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>MedBridge Africa ‚Äî EB-1A / EB-2 NIW Pre-Evaluation Report</title>
    <meta
      name="description"
      content="Indicative pre-evaluation report for EB-1A / EB-2 NIW prepared by MedBridge Africa."
    />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>
      :root {
        color-scheme: light;
        --bg: #f8fafc;
        --card: #ffffff;
        --border: #e2e8f0;
        --text-main: #0f172a;
        --text-muted: #64748b;
        --accent: #047857;
        --accent-soft: #ecfdf5;
        --danger: #b91c1c;
      }

      * {
        box-sizing: border-box;
      }

      body {
        margin: 0;
        font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
          sans-serif;
        background: radial-gradient(circle at top left, #ecfdf5, #f8fafc 40%);
        color: var(--text-main);
      }

      .page {
        max-width: 850px;
        margin: 32px auto;
        padding: 16px;
      }

      .card {
        background: var(--card);
        border-radius: 24px;
        border: 1px solid var(--border);
        padding: 24px 24px 28px;
        box-shadow: 0 18px 60px rgba(15, 23, 42, 0.08);
      }

      h1 {
        font-size: 1.7rem;
        margin: 0 0 0.25rem 0;
      }

      h2 {
        font-size: 1.1rem;
        margin: 1.5rem 0 0.5rem;
      }

      p {
        margin: 0.4rem 0;
      }

      .muted {
        color: var(--text-muted);
        font-size: 0.9rem;
      }

      .badge {
        display: inline-flex;
        align-items: center;
        gap: 0.4rem;
        background: var(--accent-soft);
        color: var(--accent);
        border-radius: 999px;
        padding: 0.2rem 0.75rem;
        font-size: 0.8rem;
        font-weight: 600;
      }

      .score-row {
        display: flex;
        flex-wrap: wrap;
        align-items: center;
        gap: 1rem;
        margin: 1.25rem 0 0.75rem;
      }

      .score-main {
        font-size: 2.4rem;
        font-weight: 800;
        color: var(--accent);
      }

      .program-tag {
        font-size: 0.9rem;
        font-weight: 600;
        padding: 0.3rem 0.7rem;
        border-radius: 999px;
        background: #eef2ff;
        color: #3730a3;
      }

      .pill {
        display: inline-flex;
        align-items: center;
        padding: 0.3rem 0.7rem;
        border-radius: 999px;
        font-size: 0.78rem;
        background: #fefce8;
        color: #854d0e;
        border: 1px solid #fef3c7;
        margin-top: 0.25rem;
      }

      .section {
        margin-top: 1.25rem;
        padding-top: 1rem;
        border-top: 1px dashed var(--border);
      }

      ul {
        padding-left: 1.2rem;
        margin: 0.3rem 0;
      }

      li {
        margin: 0.2rem 0;
      }

      .grid-two {
        display: grid;
        grid-template-columns: minmax(0, 1.1fr) minmax(0, 1fr);
        gap: 1rem;
      }

      @media (max-width: 720px) {
        .grid-two {
          grid-template-columns: minmax(0, 1fr);
        }
      }

      .kbd {
        font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas,
          "Liberation Mono", "Courier New", monospace;
        font-size: 0.78rem;
        padding: 0.175rem 0.35rem;
        border-radius: 0.35rem;
        background: #f1f5f9;
      }

      .cta-row {
        display: flex;
        flex-wrap: wrap;
        gap: 0.6rem;
        margin-top: 1.25rem;
      }

      .btn-primary,
      .btn-secondary,
      .btn-ghost {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: 0.4rem;
        padding: 0.55rem 0.9rem;
        border-radius: 999px;
        font-size: 0.85rem;
        font-weight: 600;
        text-decoration: none;
        cursor: pointer;
      }

      .btn-primary {
        background: var(--accent);
        color: #ffffff;
        border: 1px solid var(--accent);
      }

      .btn-primary:hover {
        filter: brightness(0.95);
      }

      .btn-secondary {
        background: #ffffff;
        color: var(--text-main);
        border: 1px solid var(--border);
      }

      .btn-secondary:hover {
        background: #f8fafc;
      }

      .btn-ghost {
        background: transparent;
        color: var(--text-muted);
        border: none;
      }

      .footer {
        margin-top: 1.75rem;
        text-align: left;
        font-size: 0.8rem;
        color: var(--text-muted);
      }

      .danger {
        color: var(--danger);
        font-weight: 600;
      }

      .small {
        font-size: 0.85rem;
      }
    </style>
  </head>
  <body>
    <div class="page">
      <div class="card">
        <div class="badge">
          MedBridge Africa ¬∑ EB-1A / EB-2 NIW Pre-Evaluation
        </div>

        <h1>Pre-Evaluation Report ‚Äî MedBridge Africa</h1>
        <p class="muted">
          This indicative report is generated from your answers to the
          pre-evaluation form. It does <strong>not</strong> replace legal
          advice and is not an official eligibility decision.
        </p>

        <div class="score-row">
          <div>
            <div id="score-main" class="score-main">70 / 100</div>
            <div id="program-tag" class="program-tag">
              Example: Potential EB-2 NIW profile
            </div>
          </div>
          <div>
            <p id="score-interpretation" class="small">
              Example: profile with EB-2 NIW potential, with points to be
              strengthened for EB-1A and a more robust NIW strategy.
            </p>
            <p class="pill">
              ‚öñÔ∏è This score is indicative and based on the information you
              entered.
            </p>
          </div>
        </div>

        <!-- SUMMARY -->
        <div class="section">
          <h2>1. Profile Summary</h2>
          <p id="profile-summary">
            Example: African health professional or researcher with a developing
            track record. Your detailed answers will soon be reflected here in a
            dynamic way.
          </p>
          <p id="profile-email" class="muted small"></p>
        </div>

        <!-- METRICS + PROJECT -->
        <div class="section grid-two">
          <div>
            <h2>2. Academic & Professional Indicators</h2>
            <ul id="metrics-list">
              <li>Publications: example (0 listed)</li>
              <li>Citations: example (0)</li>
              <li>Awards / distinctions: example (none reported)</li>
            </ul>
          </div>
          <div>
            <h2>3. Proposed Project & Impact</h2>
            <p id="project-context">
              Example: project still being described. The final report will use
              your answers regarding the sector, target location and expected
              impact in the United States.
            </p>
          </div>
        </div>

        <!-- RECOMMENDATIONS -->
        <div class="section">
          <h2>4. Key Recommendations</h2>
          <div id="recommendations-block">
            <ul>
              <li>
                Strengthen publications and scientific output (ideally ‚â• 3‚Äì5
                indexed articles or equivalent).
              </li>
              <li>
                Identify and document awards, grants, distinctions or leadership
                positions (even at national or regional level).
              </li>
              <li>
                Clarify the project in the U.S. (beneficiaries, national impact,
                measurable outcomes).
              </li>
              <li>
                Prepare a 12‚Äì18 month visibility plan (publications,
                conferences, collaborations).
              </li>
            </ul>
          </div>

          <p class="muted small">
            These recommendations are indicative and will be adapted
            automatically based on the detailed information you provide in the
            full evaluation form.
          </p>
        </div>

        <!-- CTA -->
        <div class="section">
          <h2>5. Next Possible Steps with MedBridge Africa</h2>
          <p class="small">
            To move from an indicative score to a structured EB-1A / EB-2 NIW
            strategy, we recommend a 30‚Äì60 minute consultation to review your
            CV, evidence and project in more depth.
          </p>
          <div class="cta-row">
            <a
              href="https://calendly.com/adama-ndir/30min"
              class="btn-primary"
              target="_blank"
              rel="noreferrer"
              >üìÖ Book a 30-minute call</a
            >
            <a
              href="mailto:contact@healthacademia.shop"
              class="btn-secondary"
              >üìß Send your CV for a first review</a
            >
            <a
              href="https://wa.me/221771609016"
              class="btn-secondary"
              target="_blank"
              rel="noreferrer"
              >üí¨ Ask questions via WhatsApp</a
            >
          </div>

          <div class="cta-row">
            <a href="/en/evaluation" class="btn-ghost">‚Üê Back to the form</a>
          </div>
        </div>

        <div class="footer" id="footer-status">
          No data found in your browser (empty localStorage). This page displays
          an example only.
        </div>
      </div>
    </div>

    <script>
      // Envoi du rapport par email via Netlify Function
      function sendReportByEmail() {
        try {
          const raw = localStorage.getItem("mba_eval_result_v1");
          if (!raw) {
            alert("No preliminary assessment data was found in this browser.");
            return;
          }

          fetch("/.netlify/functions/send-mail", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: raw, // raw est d√©j√† une cha√Æne JSON
          })
            .then((res) => res.json().catch(() => ({})))
            .then(() => {
              alert(
                "Your report has been sent for email delivery. Please check your inbox."
              );
            })
            .catch((err) => {
              console.error("Email sent error:", err);
              alert("Unable to send the email at this time.");
            });
        } catch (e) {
          console.error("Access error localStorage:", e);
          alert("Unable to read report data.");
        }
      }

      document.addEventListener("DOMContentLoaded", function () {
        // Year in footer
        const yearSpan = document.getElementById("year");
        if (yearSpan) yearSpan.textContent = new Date().getFullYear();

        const scoreLine = document.getElementById("score-line");
        const programGuessEl = document.getElementById("program-guess");
        const bandTextEl = document.getElementById("band-text");
        const profileSummaryEl = document.getElementById("profile-summary");
        const profileEmailEl = document.getElementById("profile-email");
        const metricsListEl = document.getElementById("metrics-list");
        const projectTextEl = document.getElementById("project-text");
        const recoListEl = document.getElementById("reco-list");
        const placeholderNote = document.getElementById("placeholder-note");
        const progressBar = document.getElementById("progress-bar");

        // Lecture du localStorage
        let raw = null;
        try {
          raw = localStorage.getItem("mba_eval_result_v1");
        } catch (e) {
          console.warn("Unable to read localStorage:", e);
        }

        if (!raw) {
          // Aucun r√©sultat -> on garde l'exemple par d√©faut
          if (placeholderNote) {
            placeholderNote.textContent =
              "No data found in the browser (default example displayed).";
          }
          return;
        }

        let data = null;
        try {
          data = JSON.parse(raw);
        } catch (e) {
          console.warn("Invalid JSON in mba_eval_result_v1:", e);
          if (placeholderNote) {
            placeholderNote.textContent =
              "Error loading data. Default example displayed.";
          }
          return;
        }

        const score = typeof data.score === "number" ? data.score : 0;
        const programGuess = data.programGuess || "Profile in progress";
        const profile = data.profile || {};
        const metrics = data.metrics || {};
        const project = data.project || {};
        const recos = Array.isArray(data.recommendations)
          ? data.recommendations
          : [];

        // --- Interpretation strip ---
        let bandLabel = "";
        let bandDetail = "";

        if (score >= 85) {
          bandLabel = "Very solid profile for an EB-1A / EB-2 NIW case.";
          bandDetail =
            "You already have a strong track record. The main challenge will be to strategically structure your evidence and narrative with the support of an expert and, if necessary, an attorney.";
        } else if (score >= 70) {
          bandLabel =
            "Good potential for an EB-2 NIW, with the possibility of aiming for EB-1A in the medium term.";
          bandDetail =
            "Your profile has several strengths. Targeted work on impact, leadership, and international visibility can bring you closer to a competitive EB-1A case.";
        } else if (score >= 55) {
          bandLabel =
            "Profile on the right track for an EB-2 NIW, but still needs strengthening.";
          bandDetail =
            "It will be useful to plan, over 12‚Äì24 months, concrete actions (publications, responsibilities, collaborations, U.S. project) before filing.";
        } else {
          bandLabel =
            "Profile still early for an EB-1A / EB-2 NIW in the short term.";
          bandDetail =
            "The priority is to build a stronger CV (publications, distinctions, key responsibilities, high-impact project) before investing in a qualified immigration strategy.";
        }

        // --- Score & category ---
        if (scoreLine) scoreLine.textContent = `${score} / 100`;
        if (programGuessEl) programGuessEl.textContent = programGuess;
        if (bandTextEl) bandTextEl.textContent = `${bandLabel} ${bandDetail}`;
        if (progressBar) {
          progressBar.style.width = `${Math.max(0, Math.min(100, score))}%`;
        }

        // --- Profile summary (align√© avec le formulaire EN) ---
        const name = profile.fullName || "Candidate";
        const email = profile.email || "";
        const country = profile.country || "Country not specified";
        const education =
          profile.educationLevel || "Education level not specified";
        const years =
          typeof profile.yearsExperience === "number"
            ? profile.yearsExperience
            : null;
        const summary = profile.summary || "";
        const targetProgram =
          profile.targetProgram || "a qualified immigration program";

        let profileText = `${name} is considering a skilled immigration strategy (${targetProgram}) with an academic level of ${education.toLowerCase()}.`;
        if (years !== null) {
          profileText += ` Post-graduate experience: approximately ${years} year(s).`;
        }
        profileText += ` Main country / professional context: ${country}.`;
        if (summary && summary.trim().length > 0) {
          profileText += `\n\nBackground summary: ${summary}`;
        }

        if (profileSummaryEl) {
          profileSummaryEl.textContent = profileText;
        }

        if (profileEmailEl) {
          profileEmailEl.textContent = email
            ? `Email: ${email} ‚Ä¢ This report is indicative and should be reviewed with a MedBridge Africa advisor.`
            : `Email: not provided ‚Ä¢ This report is indicative and should be reviewed with a MedBridge Africa advisor.`;
        }

        // --- Academic & professional indicators ---
        if (metricsListEl) {
          metricsListEl.innerHTML = "";
          const pubs = metrics.pubs ?? 0;
          const cites = metrics.cites ?? 0;
          const awards = metrics.awards;

          const liP = document.createElement("li");
          liP.textContent = `Publications: ${pubs} (A higher volume and better indexing strongly strengthens the case).`;
          metricsListEl.appendChild(liP);

          const liC = document.createElement("li");
          liC.textContent = `Citations: ${cites} (Bibliometric impact documents scientific recognition).`;
          metricsListEl.appendChild(liC);

          const liA = document.createElement("li");
          liA.textContent = awards
            ? "Awards/distinctions: some elements have been mentioned; to be documented in detail (context, scope, jury)."
            : "Awards/distinctions: no detailed elements at this time (opportunity to strengthen this area).";
          metricsListEl.appendChild(liA);
        }

        // --- Project & impact ---
        if (projectTextEl) {
          if (project.summary) {
            projectTextEl.textContent = `Sector: ${
              project.sector || "not specified"
            }. Target place/context: ${
              project.place || "not specified"
            }.\n\nProject summary: ${project.summary}`;
          } else {
            projectTextEl.textContent =
              "Your project is not yet described in detail in the form. Please specify the sector, place, and expected impacts in the United States.";
          }
        }

        // --- Recommendations ---
        if (recoListEl && recos.length > 0) {
          recoListEl.innerHTML = "";
          recos.forEach((r) => {
            const li = document.createElement("li");
            li.textContent = r;
            recoListEl.appendChild(li);
          });
        }

        // --- Footer note ---
        if (placeholderNote) {
          placeholderNote.textContent =
            "Data loaded from the browser. Personalized report displayed.";
        }
      });
    </script>

  </body>
</html>
