<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>MedBridge Africa — Formulaire de pré-évaluation</title>
    <style>
      body {
        font-family: Arial, Helvetica, sans-serif;
        background: #f1f5f9;
        margin: 0;
        color: #0f172a;
      }

      main {
        max-width: 900px;
        margin: 0 auto;
        padding: 24px 16px 40px;
      }

      h1 {
        text-align: center;
        color: #0f766e;
        margin-top: 12px;
        margin-bottom: 8px;
      }

      p.lead {
        text-align: center;
        max-width: 720px;
        margin: 0 auto 20px auto;
        font-size: 0.95rem;
        color: #475569;
      }

      .card {
        background: #ffffff;
        border: 1px solid #e2e8f0;
        border-radius: 12px;
        padding: 20px;
        margin-top: 20px;
        box-shadow: 0 4px 10px rgba(15, 23, 42, 0.04);
      }

      h2 {
        margin-top: 0;
        color: #0f172a;
        font-size: 1.1rem;
      }

      label {
        display: block;
        margin-top: 10px;
        font-weight: 600;
        font-size: 0.95rem;
      }

      input,
      textarea,
      select {
        width: 100%;
        padding: 8px 10px;
        margin-top: 4px;
        border: 1px solid #cbd5e1;
        border-radius: 6px;
        font-size: 0.95rem;
        box-sizing: border-box;
      }

      textarea {
        resize: vertical;
        min-height: 80px;
      }

      .hint {
        font-size: 0.8rem;
        color: #64748b;
        margin-top: 2px;
      }

      .grid-2 {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 12px;
      }

      .actions {
        margin-top: 22px;
        display: flex;
        justify-content: flex-end;
      }

      button {
        border: none;
        border-radius: 999px;
        padding: 10px 20px;
        font-size: 0.95rem;
        cursor: pointer;
        font-weight: 600;
      }

      #submit-btn {
        background: #0f766e;
        color: #ffffff;
      }

      #submit-btn:hover {
        background: #115e59;
      }

      .footer-note {
        margin-top: 20px;
        font-size: 0.8rem;
        color: #64748b;
        text-align: center;
      }

      @media (max-width: 640px) {
        .grid-2 {
          grid-template-columns: 1fr;
        }
      }
    </style>
  </head>
  <body>
    <main>
      <h1>Formulaire de pré-évaluation EB-1A / EB-2 NIW</h1>
      <p class="lead">
        Ce formulaire permet de générer un <strong>rapport indicatif</strong> sur
        votre potentiel EB-1A / EB-2 NIW. Il ne remplace pas un avis juridique,
        mais constitue un outil d’aide à la décision pour votre parcours avec
        MedBridge Africa.
      </p>

      <form id="eval-form">
        <!-- Bloc 1 : Profil -->
        <section class="card">
          <h2>1) Profil & programme visé</h2>

          <label for="program">Programme visé</label>
          <select id="program" required>
            <option value="">— choisir —</option>
            <option value="EB1-A">EB1-A</option>
            <option value="EB2-NIW">EB2-NIW</option>
          </select>

          <div class="grid-2">
            <div>
              <label for="fullName">Nom complet</label>
              <input
                id="fullName"
                type="text"
                placeholder="Ex : ADAMA NDIR"
                required
              />
            </div>
            <div>
              <label for="email">Adresse e-mail</label>
              <input
                id="email"
                type="email"
                placeholder="vous@example.com"
                required
              />
            </div>
          </div>

          <div class="grid-2">
            <div>
              <label for="education">Niveau d’études principal</label>
              <select id="education" required>
                <option value="">— choisir —</option>
                <option value="Licence">Licence / Bachelor</option>
                <option value="Master">Master</option>
                <option value="Doctorat">Doctorat / PhD / Spécialité</option>
                <option value="Autre">Autre</option>
              </select>
            </div>
            <div>
              <label for="years">Années d’expérience professionnelle</label>
              <input
                id="years"
                type="number"
                min="0"
                placeholder="Ex : 8"
                required
              />
            </div>
          </div>

          <div class="grid-2">
            <div>
              <label for="country">Pays d’exercice / résidence</label>
              <input
                id="country"
                type="text"
                placeholder="Ex : Sénégal, Côte d’Ivoire, etc."
              />
            </div>
          </div>

          <label for="summary">Résumé de votre profil</label>
          <textarea
            id="summary"
            placeholder="Décrivez brièvement votre profil : domaine (santé publique, IA, épidémiologie...), rôle actuel, responsabilités, principaux résultats..."
          ></textarea>
          <div class="hint">
            Idéalement 5–8 lignes. Plus la description est précise, plus
            l’interprétation sera pertinente.
          </div>
        </section>

        <!-- Bloc 2 : Indicateurs académiques -->
        <section class="card">
          <h2>2) Indicateurs académiques & professionnels</h2>

          <div class="grid-2">
            <div>
              <label for="pubs">Publications scientifiques (nombre)</label>
              <input
                id="pubs"
                type="number"
                min="0"
                value="0"
                required
              />
              <div class="hint">
                Inclure articles indexés, chapitres d’ouvrage, éventuellement
                rapports techniques importants.
              </div>
            </div>
            <div>
              <label for="cites">Citations (approximation)</label>
              <input
                id="cites"
                type="number"
                min="0"
                value="0"
                required
              />
              <div class="hint">
                Estimation Google Scholar / Scopus si possible. Sinon mettre 0
                ou “au mieux de vos connaissances”.
              </div>
            </div>
          </div>

          <label for="awards">Prix / distinctions (nombre total)</label>
          <input id="awards" type="number" min="0" value="0" />
          <div class="hint">
            Inclure bourses compétitives, prix scientifiques, reconnaissances
            nationales / internationales, distinctions majeures.
          </div>
        </section>

        <!-- Bloc 3 : Projet & impact -->
        <section class="card">
          <h2>3) Projet aux États-Unis & impact</h2>

          <label for="sector">Secteur / domaine principal du projet</label>
          <input
            id="sector"
            type="text"
            placeholder="Ex : Santé publique, IA appliquée à la santé, épidémiologie de terrain..."
          />

          <label for="location">Lieu / contexte envisagé</label>
          <input
            id="location"
            type="text"
            placeholder="Ex : collaboration avec une université, un hôpital, un programme de santé, etc."
          />

          <label for="project">
            Description du projet et de l’impact attendu
          </label>
          <textarea
            id="project"
            placeholder="Expliquez ce que vous souhaitez mettre en place aux États-Unis : problématique, approche, bénéficiaires, impact attendu (santé publique, innovation, underserved populations, etc.)."
          ></textarea>
          <div class="hint">
            Là aussi, 10–15 lignes sont idéales. Même une version préliminaire
            est utile pour le rapport.
          </div>
        </section>

        <!-- Actions -->
        <div class="actions">
          <button type="button" id="submit-btn">Soumettre et voir le rapport</button>
        </div>
      </form>

      <p class="footer-note">
        Le rapport généré est indicatif et ne constitue pas un avis juridique.
        Il sera affiné lors d’un échange avec MedBridge Africa.
      </p>
    </main>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const submitBtn = document.getElementById("submit-btn");

        function computeScore(data) {
          let score = 0;

          // Programme
          if (data.program === "EB1-A") {
            score += 10;
          } else if (data.program === "EB2-NIW") {
            score += 8;
          }

          // Niveau d’études
          switch (data.education) {
            case "Licence":
              score += 5;
              break;
            case "Master":
              score += 8;
              break;
            case "Doctorat":
              score += 12;
              break;
            default:
              score += 3;
          }

          // Années d’expérience
          const years = data.years || 0;
          if (years > 0) {
            score += Math.min(years, 20); // 1 point par année, max 20
          }
          if (years >= 10) {
            score += 5;
          }

          // Publications
          const pubs = data.pubs || 0;
          if (pubs === 0) {
            score += 0;
          } else if (pubs <= 2) {
            score += 5;
          } else if (pubs <= 5) {
            score += 10;
          } else if (pubs <= 10) {
            score += 15;
          } else {
            score += 20;
          }

          // Citations
          const cites = data.cites || 0;
          if (cites === 0) {
            score += 0;
          } else if (cites <= 50) {
            score += 5;
          } else if (cites <= 200) {
            score += 10;
          } else {
            score += 15;
          }

          // Prix / distinctions
          const awards = data.awards || 0;
          if (awards > 0) {
            score += 8;
          }

          // Qualité du résumé / projet (longueur)
          const summaryLen = (data.summary || "").trim().length;
          if (summaryLen >= 200 && summaryLen < 400) {
            score += 5;
          } else if (summaryLen >= 400) {
            score += 8;
          }

          const projectLen = (data.projectDesc || "").trim().length;
          if (projectLen >= 200 && projectLen < 400) {
            score += 5;
          } else if (projectLen >= 400) {
            score += 8;
          }

          // Cap à 100
          if (score > 100) score = 100;
          if (score < 0) score = 0;
          return Math.round(score);
        }

        function buildProgramGuess(score, program) {
          if (score >= 85) {
            return "Très fort potentiel pour un dossier EB1-A / EB2-NIW.";
          }
          if (score >= 70) {
            return "Potentiel EB2-NIW avec des éléments à renforcer pour EB1-A.";
          }
          if (score >= 50) {
            return "Profil en consolidation, EB2-NIW envisageable à moyen terme.";
          }
          return "Profil initial, plusieurs éléments restent à développer avant un dossier EB2-NIW / EB1-A.";
        }

        function buildRecommendations(data, score) {
          const recos = [];

          if (data.pubs === 0) {
            recos.push(
              "Renforcer le volume de publications (idéalement ≥ 3–5 articles indexés) dans votre domaine de spécialité."
            );
          } else if (data.pubs < 5) {
            recos.push(
              "Poursuivre les publications dans des revues visibles (indexées, comité de lecture) pour consolider la dimension académique."
            );
          }

          if (data.awards === 0) {
            recos.push(
              "Identifier et documenter tout prix, bourse ou distinction (même régionale ou nationale) pour renforcer les preuves d’excellence."
            );
          }

          if (!data.summary || data.summary.trim().length < 200) {
            recos.push(
              "Clarifier davantage votre rôle, vos responsabilités et vos contributions spécifiques (impact, leadership, innovation)."
            );
          }

          if (!data.projectDesc || data.projectDesc.trim().length < 200) {
            recos.push(
              "Développer davantage la description du projet envisagé aux États-Unis (bénéficiaires, impact national, indicateurs mesurables)."
            );
          }

          if (score < 70) {
            recos.push(
              "Prévoir 12–18 mois de stratégie de visibilité (publications, conférences, collaborations, implication dans des réseaux professionnels)."
            );
          }

          if (recos.length === 0) {
            recos.push(
              "Votre profil semble déjà bien structuré. Un travail fin restera nécessaire pour aligner le dossier avec les critères formels EB1-A / EB2-NIW."
            );
          }

          return recos;
        }

        submitBtn.addEventListener("click", function (e) {
          e.preventDefault();

          const program = (document.getElementById("program").value || "").trim();
          const fullName = (document.getElementById("fullName").value || "").trim();
          const email = (document.getElementById("email").value || "").trim();
          const education = (document.getElementById("education").value || "").trim();
          const years = Number(document.getElementById("years").value || "0");
          const country = (document.getElementById("country").value || "").trim();
          const summary = (document.getElementById("summary").value || "").trim();

          const pubs = Number(document.getElementById("pubs").value || "0");
          const cites = Number(document.getElementById("cites").value || "0");
          const awards = Number(document.getElementById("awards").value || "0");

          const sector = (document.getElementById("sector").value || "").trim();
          const location = (document.getElementById("location").value || "").trim();
          const projectDesc = (document.getElementById("project").value || "").trim();

          if (!program || !fullName || !email) {
            alert(
              "Merci de renseigner au minimum le programme visé, votre nom complet et votre adresse e-mail."
            );
            return;
          }

          const rawData = {
            program,
            fullName,
            email,
            education,
            years,
            country,
            summary,
            pubs,
            cites,
            awards,
            sector,
            location,
            projectDesc,
          };

          const score = computeScore(rawData);
          const programGuess = buildProgramGuess(score, program);
          const recommendations = buildRecommendations(rawData, score);

          const profile = {
            fullName,
            email,
            targetProgram: program,
            educationLevel: education,
            yearsExperience: years,
            country,
            summary,
          };

          const metrics = {
            publications: pubs,
            citations: cites,
            awards,
          };

          const project = {
            sector,
            location,
            description: projectDesc,
          };

          const payload = {
            score,
            programGuess,
            profile,
            metrics,
            project,
            recommendations,
          };

          try {
            localStorage.setItem(
              "mba_eval_result_v1",
              JSON.stringify(payload)
            );
            console.log("[EVAL-FR] Données stockées:", payload);
          } catch (err) {
            console.warn("Impossible d'écrire dans localStorage:", err);
          }

          alert(
            "Merci ! Vos informations ont été enregistrées.\nVous allez maintenant voir un rapport indicatif basé sur vos réponses."
          );
          window.location.href = "evaluation-report.html";
        });
      });
    </script>
  </body>
</html>
