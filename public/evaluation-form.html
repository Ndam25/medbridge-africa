<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>MedBridge Africa ‚Äî Rapport de pr√©-√©valuation</title>
    <style>
      body {
        font-family: Arial, Helvetica, sans-serif;
        background: #f1f5f9;
        margin: 0;
        color: #0f172a;
      }
      header {
        background: #0f766e;
        color: white;
        padding: 18px 20px;
      }
      header h1 {
        margin: 0;
        font-size: 1.4rem;
      }
      header p {
        margin: 4px 0 0;
        font-size: 0.9rem;
        opacity: 0.9;
      }
      main {
        max-width: 900px;
        margin: 24px auto 32px;
        padding: 0 16px;
      }
      .card {
        background: #fff;
        border-radius: 14px;
        padding: 28px;
        margin-top: 22px;
        box-shadow: 0 8px 24px rgba(15, 23, 42, 0.08);
        border: 1px solid #e2e8f0;
      }
      h2 {
        margin-top: 0;
        font-size: 1.3rem;
        margin-bottom: 12px;
        color: #0f172a;
      }
      .score-row {
        display: flex;
        flex-wrap: wrap;
        align-items: baseline;
        gap: 12px;
      }
      .score-big {
        font-size: 3rem;
        font-weight: 800;
        color: #0f766e;
      }
      .score-badge {
        display: inline-block;
        padding: 4px 10px;
        border-radius: 999px;
        font-size: 0.85rem;
        font-weight: 600;
        background: #e0f2fe;
        color: #0369a1;
      }
      .muted {
        color: #64748b;
        font-size: 0.9rem;
      }
      .progress {
        width: 100%;
        background: #e2e8f0;
        border-radius: 999px;
        height: 12px;
        overflow: hidden;
        margin-top: 10px;
        margin-bottom: 4px;
      }
      .progress-bar {
        height: 12px;
        background: #0f766e;
        width: 70%;
        transition: width 0.8s ease;
      }
      ul {
        padding-left: 18px;
      }
      li {
        margin-bottom: 4px;
      }
      footer {
        text-align: center;
        margin: 10px 0 16px;
        color: #94a3b8;
        font-size: 0.85rem;
      }
      .btn-link {
        display: inline-block;
        margin-top: 10px;
        padding: 8px 14px;
        border-radius: 8px;
        background: #0f172a;
        color: white;
        font-size: 0.9rem;
        text-decoration: none;
      }
      .btn-link:hover {
        opacity: 0.95;
      }
      .cta-container {
        text-align: center;
        margin-top: 18px;
      }
      .cta-main {
        display: inline-block;
        background: #0f766e;
        color: white;
        padding: 14px 26px;
        border-radius: 12px;
        font-size: 1rem;
        font-weight: 600;
        text-decoration: none;
      }
      .cta-main:hover {
        background: #0d5d56;
        transition: 0.3s ease;
      }
      .cta-secondary {
        display: block;
        text-align: center;
        margin-top: 10px;
        font-size: 0.9rem;
        color: #0f172a;
        text-decoration: none;
      }
      .cta-secondary:hover {
        text-decoration: underline;
      }
      .pdf-btn {
        margin-top: 20px;
        display: inline-block;
        padding: 10px 18px;
        border-radius: 10px;
        background: #1e293b;
        color: #fff;
        font-size: 0.9rem;
        text-decoration: none;
        border: none;
        cursor: pointer;
      }
      .pdf-btn:hover {
        opacity: 0.9;
      }
      .note-placeholder {
        margin-top: 10px;
        font-size: 0.85rem;
        color: #6b7280;
      }

      @media print {
        .cta-container,
        .pdf-btn,
        .btn-link {
          display: none !important;
        }
        body {
          background: white;
        }
        .card {
          box-shadow: none;
          border: none;
          page-break-inside: avoid;
        }
        header {
          background: white;
          color: #0f172a;
          border-bottom: 1px solid #e2e8f0;
        }
      }
    </style>
  </head>
  <body>
    <header>
      <h1>MedBridge Africa ‚Äî Rapport de pr√©-√©valuation</h1>
     <p>
Pr√©-√©valuation EB-1A / EB-2 NIW par MedBridge Africa ‚Äî un outil d‚Äôorientation
strat√©gique pour les professionnels de sant√© africains (sans valeur juridique).
</p>

    </header>

    <main>
      <!-- Carte 1 : R√©sultat global -->
      <section class="card">
        <h2>R√©sultat global</h2>
        <div class="score-row">
          <div class="score-big" id="score-line">70 / 100</div>
          <div class="score-badge" id="program-guess">
            Exemple indicatif ‚Äî profil EB2-NIW √† renforcer pour EB1-A
          </div>
        </div>

        <div class="progress">
          <div class="progress-bar" id="progress-bar"></div>
        </div>

        <p class="muted" id="band-text">
          Interpr√©tation rapide bas√©e sur un exemple de profil. Le rapport r√©el se
          mettra √† jour automatiquement √† partir de vos r√©ponses.
        </p>
      </section>

      <!-- Carte 2 : Profil -->
      <section class="card">
        <h2>R√©sum√© du profil</h2>
        <p id="profile-summary">
          Exemple : professionnel de sant√© ou chercheur africain, avec un parcours
          en cours de structuration. Le d√©tail de vos r√©ponses sera pris en compte
          de mani√®re dynamique dans cette section.
        </p>
        <p class="muted" id="profile-email">
          Email : non renseign√© ‚Ä¢ Ce rapport reste indicatif et devra √™tre revu
          avec un conseiller MedBridge Africa.
        </p>
      </section>

      <!-- Carte 3 : Indicateurs acad√©miques et professionnels -->
      <section class="card">
        <h2>Indicateurs acad√©miques et professionnels</h2>
        <ul id="metrics-list">
          <li>Publications : exemple (0 renseign√©es)</li>
          <li>Citations : exemple (0)</li>
          <li>Prix / distinctions : exemple (non renseign√©)</li>
        </ul>
      </section>

      <!-- Carte 4 : Projet & impact -->
      <section class="card">
        <h2>Projet et impact propos√©</h2>
        <p id="project-text">
          Exemple : projet en cours de description. Le rapport final reprendra vos
          r√©ponses sur le secteur, le lieu et l‚Äôimpact envisag√© aux √âtats-Unis.
        </p>
      </section>

      <!-- Carte 5 : Recommandations -->
      <section class="card">
        <h2>Recommandations principales</h2>
        <ul id="reco-list">
          <li>Consolider les lettres de recommandation (US si possible).</li>
          <li>
            Documenter l‚Äôimpact national et l‚Äôalignement avec les priorit√©s
            am√©ricaines (sant√© publique, innovation, IA, underserved populations).
          </li>
          <li>
            Planifier 12‚Äì18 mois de publications et communications strat√©giques
            avant d√©p√¥t du dossier.
          </li>
        </ul>
        <p class="muted">
          Ces recommandations seront adapt√©es automatiquement en fonction des
          informations que vous avez fournies dans le formulaire complet.
        </p>

        <a href="evaluation-form.html" class="btn-link">
          ‚Üê Revenir au formulaire
        </a>

        <div style="text-align:center;">
          <button onclick="window.print()" class="pdf-btn">
            üìÑ T√©l√©charger ce rapport en PDF
          </button>
        </div>

        <div style="text-align:center;">
          <button onclick="sendReportByEmail()" class="pdf-btn">
            ‚úâÔ∏è M‚Äôenvoyer ce rapport par email
          </button>
        </div>

        <p class="note-placeholder" id="placeholder-note">
          Aucune donn√©e trouv√©e dans le navigateur (exemple par d√©faut affich√©).
        </p>
      </section>

      <!-- Carte 6 : Call-to-Action MedBridge Africa -->
      <section class="card">
        <h2>√âtape suivante avec MedBridge Africa</h2>
 <p>
  Cette pr√©-√©valuation vous donne une premi√®re photographie de votre profil.
  Pour transformer ce score en une v√©ritable strat√©gie EB-1A / EB-2 NIW,
  adapt√©e √† votre parcours et √† votre contexte africain, MedBridge Africa
  vous accompagne √©tape par √©tape :
</p>


        <div class="cta-container">
          <a
            href="https://calendly.com/adama-ndir/30min"
            class="cta-main"
            target="_blank"
            rel="noreferrer"
          >
            üìÖ R√©server un appel de 30 minutes
          </a>

          <a
            class="cta-secondary"
            href="https://wa.me/221771609016"
            target="_blank"
            rel="noreferrer"
          >
            üí¨ Discuter sur WhatsApp
          </a>

          <a
            class="cta-secondary"
            href="mailto:contact@healthacademia.shop"
          >
            üìß Envoyer un email √† MedBridge Africa
          </a>

          <a class="cta-secondary" href="#">
            ‚≠ê Demander une analyse experte EB-1A / EB-2 NIW (r√©serv√©e aux
            clients abonn√©s)
          </a>
        </div>

        <p class="muted" style="margin-top:16px;">
          üîí L‚Äôanalyse d√©taill√©e EB-1A / EB-2 NIW (avec grille experte et revue
          de dossier) est r√©serv√©e aux personnes qui acceptent une consultation
          ou souscrivent √† un pack d‚Äôaccompagnement MedBridge Africa.
        </p>
      </section>
    </main>

    <footer>
      ¬© <span id="year"></span> MedBridge Africa. Tous droits r√©serv√©s.
    </footer>

    <script>
      function sendReportByEmail() {
        try {
          const raw = localStorage.getItem("mba_eval_result_v1");
          if (!raw) {
            alert(
              "Aucune donn√©e de pr√©-√©valuation n'a √©t√© trouv√©e dans ce navigateur."
            );
            return;
          }

          fetch("/.netlify/functions/send-mail", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: raw, // raw est d√©j√† une cha√Æne JSON
          })
            .then((res) => res.json().catch(() => ({})))
            .then(() => {
              alert(
                "Votre rapport a √©t√© transmis pour envoi par email. V√©rifiez votre bo√Æte de r√©ception."
              );
            })
            .catch((err) => {
              console.error("Erreur d'envoi du mail:", err);
              alert("Impossible d'envoyer l'email pour le moment.");
            });
        } catch (e) {
          console.error("Erreur acc√®s localStorage:", e);
          alert("Impossible de lire les donn√©es du rapport.");
        }
      }

      document.addEventListener("DOMContentLoaded", function () {
        // Ann√©e footer
        const yearSpan = document.getElementById("year");
        if (yearSpan) yearSpan.textContent = new Date().getFullYear();

        const scoreLine = document.getElementById("score-line");
        const programGuessEl = document.getElementById("program-guess");
        const bandTextEl = document.getElementById("band-text");
        const profileSummaryEl = document.getElementById("profile-summary");
        const profileEmailEl = document.getElementById("profile-email");
        const metricsListEl = document.getElementById("metrics-list");
        const projectTextEl = document.getElementById("project-text");
        const recoListEl = document.getElementById("reco-list");
        const placeholderNote = document.getElementById("placeholder-note");
        const progressBar = document.getElementById("progress-bar");

        let raw = null;
        try {
          raw = localStorage.getItem("mba_eval_result_v1");
        } catch (e) {
          console.warn("Impossible de lire localStorage:", e);
        }

        if (!raw) {
          // On garde l'exemple par d√©faut
          if (placeholderNote) {
            placeholderNote.textContent =
              "Aucune donn√©e trouv√©e dans le navigateur (exemple par d√©faut affich√©).";
          }
          return;
        }

        let data = null;
        try {
          data = JSON.parse(raw);
        } catch (e) {
          console.warn("JSON invalide dans mba_eval_result_v1:", e);
          if (placeholderNote) {
            placeholderNote.textContent =
              "Erreur lors du chargement des donn√©es. Exemple par d√©faut affich√©.";
          }
          return;
        }

        const score = typeof data.score === "number" ? data.score : 0;
        const programGuess = data.programGuess || "Profil en construction";
        const profile = data.profile || {};
        const metrics = data.metrics || {};
        const project = data.project || {};
        const recos = Array.isArray(data.recommendations)
          ? data.recommendations
          : [];

        // --- Bande d'interpr√©tation ---
        if (score >= 85) {
          bandLabel =
            "Profil tr√®s solide pour un dossier EB-1A / EB-2 NIW accompagn√©.";
          bandDetail =
            "Vous disposez d√©j√† d‚Äôun track record fort. L‚Äôenjeu principal sera de structurer vos preuves et votre narration de mani√®re strat√©gique avec l‚Äôappui d‚Äôun expert et, le cas √©ch√©ant, d‚Äôun avocat sp√©cialis√©.";
        } else if (score >= 70) {
          bandLabel =
            "Bon potentiel pour un EB-2 NIW, avec possibilit√© d‚Äôenvisager un EB-1A √† moyen terme.";
          bandDetail =
            "Votre profil pr√©sente plusieurs forces. Un travail cibl√© sur l‚Äôimpact, le leadership et la visibilit√© internationale peut vous rapprocher d‚Äôun dossier EB-1A comp√©titif.";
        } else if (score >= 55) {
          bandLabel =
            "Profil en bonne voie pour un EB-2 NIW, mais n√©cessitant encore du renforcement.";
          bandDetail =
            "Il sera utile de planifier, sur 12‚Äì24 mois, des actions concr√®tes (publications, responsabilit√©s formelles, collaborations internationales, projet structur√© aux √âtats-Unis) avant d‚Äôenvisager un d√©p√¥t de dossier.";
        } else {
          bandLabel =
            "Profil encore pr√©coce pour un EB-1A / EB-2 NIW √† court terme.";
          bandDetail =
            "La priorit√© est de construire un CV plus robuste (publications, distinctions, responsabilit√©s cl√©s, projet √† fort impact) avant d‚Äôinvestir dans une strat√©gie d‚Äôimmigration qualifi√©e.";
        }


        // --- Score & programme ---
        if (scoreLine) scoreLine.textContent = `${score} / 100`;
        if (programGuessEl) programGuessEl.textContent = programGuess;
        if (bandTextEl) bandTextEl.textContent = `${bandLabel} ${bandDetail}`;
        if (progressBar) progressBar.style.width = `${Math.max(
          0,
          Math.min(100, score)
        )}%`;

        // --- R√©sum√© du profil ---
        const name = profile.full_name || "Candidat(e)";
        const email = profile.email || "";
        const country = profile.country || "Pays non pr√©cis√©";
        const education = profile.education || "Niveau non pr√©cis√©";
        const years =
          typeof profile.years === "number" ? profile.years : null;
        const summary = profile.summary || "";

        let profileText = `${name} envisage une strat√©gie d‚Äôimmigration qualifi√©e ${
  profile.program || ""
} avec un niveau acad√©mique ${education.toLowerCase()}.`;

        if (years !== null) {
          profileText += ` Exp√©rience post-dipl√¥me : environ ${years} an(s).`;
        }
        profileText += ` Pays / contexte principal : ${country}.`;
        if (summary && summary.trim().length > 0) {
          profileText += `\n\nR√©sum√© du parcours : ${summary}`;
        }

        if (profileSummaryEl) {
          profileSummaryEl.textContent = profileText;
        }
        if (profileEmailEl) {
          profileEmailEl.textContent = email
            ? `Email : ${email} ‚Ä¢ Ce rapport reste indicatif et devra √™tre revu avec un conseiller MedBridge Africa.`
            : `Email : non renseign√© ‚Ä¢ Ce rapport reste indicatif et devra √™tre revu avec un conseiller MedBridge Africa.`;
        }

        // --- Indicateurs acad√©miques & pro ---
        if (metricsListEl) {
          metricsListEl.innerHTML = "";
          const pubs = metrics.pubs ?? 0;
          const cites = metrics.cites ?? 0;
          const awards = metrics.awards;

          const liP = document.createElement("li");
          liP.textContent = `Publications : ${pubs} (un volume plus √©lev√© et mieux index√© renforce fortement le dossier).`;
          metricsListEl.appendChild(liP);

          const liC = document.createElement("li");
          liC.textContent = `Citations : ${cites} (l‚Äôimpact bibliom√©trique documente la reconnaissance scientifique).`;
          metricsListEl.appendChild(liC);

          const liA = document.createElement("li");
          liA.textContent = awards
            ? "Prix / distinctions : des √©l√©ments ont √©t√© mentionn√©s; √† documenter finement (contexte, port√©e, jury)."
            : "Prix / distinctions : aucun √©l√©ment d√©taill√© pour le moment (opportunit√© de renforcer ce volet).";
          metricsListEl.appendChild(liA);
        }

        // --- Projet & impact ---
        if (projectTextEl) {
          if (project.summary) {
            projectTextEl.textContent = `Secteur : ${
              project.sector || "non pr√©cis√©"
            }. Lieu / contexte cibl√© : ${
              project.place || "non pr√©cis√©"
            }.\n\nR√©sum√© du projet : ${project.summary}`;
          } else {
            projectTextEl.textContent =
              "Votre projet n‚Äôest pas encore d√©crit en d√©tail dans le formulaire. Pensez √† pr√©ciser le secteur, le lieu et les impacts attendus aux √âtats-Unis.";
          }
        }

        // --- Recommandations ---
        if (recoListEl && recos.length > 0) {
          recoListEl.innerHTML = "";
          recos.forEach((r) => {
            const li = document.createElement("li");
            li.textContent = r;
            recoListEl.appendChild(li);
          });
        }

        // --- Note de bas de carte ---
        if (placeholderNote) {
          placeholderNote.textContent =
            "Donn√©es charg√©es depuis le navigateur. Rapport personnalis√© affich√©.";
        }
      });
    </script>
  </body>
</html>
