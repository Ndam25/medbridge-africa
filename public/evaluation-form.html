<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Formulaire d'√âvaluation ‚Äî MedBridge Africa</title>
    <link
      href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css"
      rel="stylesheet"
    />
    <style>
      .section-title {
        font-size: 1.5rem;
        font-weight: bold;
        margin-bottom: 10px;
      }
      .form-section {
        margin-bottom: 20px;
        padding: 15px;
        background-color: #f9fafb;
        border-radius: 8px;
      }
      .btn-primary {
        background-color: #0d9488;
        color: white;
        padding: 10px 20px;
        border-radius: 5px;
        cursor: pointer;
      }
      .btn-primary:hover {
        background-color: #0f766e;
      }
    </style>
  </head>
  <body class="bg-gray-100">
    <div class="max-w-3xl mx-auto p-6">
      <h1 class="text-3xl font-bold text-center mb-6">
        Formulaire d‚Äô√âvaluation EB-1A / EB-2 NIW
      </h1>

      <p class="text-center mb-6 text-gray-600">
        Remplissez ce formulaire pour recevoir une pr√©-√©valuation de votre
        admissibilit√© EB-1A / EB-2 NIW par MedBridge Africa.
      </p>

      <form id="evaluationForm" class="space-y-6">
        <!-- SECTION 1 ‚Äì PROFIL -->
        <div class="form-section">
          <h2 class="section-title">1Ô∏è‚É£ Profil du candidat</h2>

          <label class="block mb-2 font-medium">Nom complet</label>
          <input
            type="text"
            name="fullName"
            class="w-full p-2 border rounded"
            required
          />

          <label class="block mt-4 mb-2 font-medium">Email</label>
          <input
            type="email"
            name="email"
            class="w-full p-2 border rounded"
            required
          />

          <label class="block mt-4 mb-2 font-medium"
            >Pays de r√©sidence</label
          >
          <input
            type="text"
            name="country"
            class="w-full p-2 border rounded"
            required
          />

          <label class="block mt-4 mb-2 font-medium"
            >Profession actuelle</label
          >
          <input
            type="text"
            name="currentPosition"
            class="w-full p-2 border rounded"
            required
          />
        </div>

        <!-- SECTION 2 ‚Äì INDICATEURS ACAD√âMIQUES -->
        <div class="form-section">
          <h2 class="section-title">2Ô∏è‚É£ Indicateurs acad√©miques</h2>

          <label class="block mb-2 font-medium">Nombre de publications</label>
          <input
            type="number"
            name="publications"
            class="w-full p-2 border rounded"
          />

          <label class="block mt-4 mb-2 font-medium">Citations Google Scholar</label>
          <input
            type="number"
            name="citations"
            class="w-full p-2 border rounded"
          />

          <label class="block mt-4 mb-2 font-medium">Prix / Distinctions</label>
          <input
            type="text"
            name="awards"
            class="w-full p-2 border rounded"
          />
        </div>

        <!-- SECTION 3 ‚Äì PROJET NIW -->
        <div class="form-section">
          <h2 class="section-title">3Ô∏è‚É£ Projet (EB-2 NIW)</h2>

          <label class="block mb-2 font-medium"
            >D√©crivez bri√®vement votre projet</label
          >
          <textarea
            name="project"
            class="w-full p-2 border rounded"
            rows="4"
          ></textarea>

          <label class="block mt-4 mb-2 font-medium"
            >Impact pr√©vu aux √âtats-Unis</label
          >
          <textarea
            name="impact"
            class="w-full p-2 border rounded"
            rows="3"
          ></textarea>
        </div>

        <!-- SUBMIT -->
        <button type="submit" class="btn-primary w-full text-center">
          üì§ Soumettre l‚Äô√©valuation
        </button>
      </form>

      <p class="text-center text-gray-500 mt-6 text-sm">
        ¬© 2025 MedBridge Africa ‚Äî Tous droits r√©serv√©s.
      </p>
    </div>

    <script>
  (function () {
    function computeScore(data) {
      let score = 0;
      if (data.program === "EB1-A") score += 10;
      else if (data.program === "EB2-NIW") score += 8;

      switch (data.education) {
        case "Licence":
        case "Bachelor":
          score += 5;
          break;
        case "Master":
          score += 8;
          break;
        case "Doctorat":
        case "PhD":
          score += 12;
          break;
        default:
          score += 3;
      }

      const years = Number(data.years || 0);
      if (years > 0) score += Math.min(years, 20);
      if (years >= 10) score += 5;

      const pubs = Number(data.pubs || data.publications || 0);
      if (pubs === 0) score += 0;
      else if (pubs <= 2) score += 5;
      else if (pubs <= 5) score += 10;
      else if (pubs <= 10) score += 15;
      else score += 20;

      const cites = Number(data.cites || data.citations || 0);
      if (cites === 0) score += 0;
      else if (cites <= 50) score += 5;
      else if (cites <= 200) score += 10;
      else score += 15;

      const awards = Number(data.awards || 0);
      if (awards > 0) score += 8;

      const summLen = (data.summary || data.project || "").trim().length;
      if (summLen >= 200 && summLen < 400) score += 5;
      else if (summLen >= 400) score += 8;

      if (score > 100) score = 100;
      return Math.round(score);
    }

    function buildProgramGuess(score) {
      if (score >= 85) return "Tr√®s fort potentiel pour un dossier EB1-A / EB2-NIW.";
      if (score >= 70) return "Potentiel EB2-NIW avec des √©l√©ments √† renforcer pour EB1-A.";
      if (score >= 50) return "Profil en consolidation ; EB2-NIW envisageable √† moyen terme.";
      return "Profil initial ; plusieurs √©l√©ments √† d√©velopper avant EB2-NIW / EB1-A.";
    }

    function buildRecommendations(data, score) {
      const recos = [];
      const pubs = Number(data.pubs || data.publications || 0);
      const awards = Number(data.awards || 0);
      const summary = (data.summary || data.project || "").trim();
      if (pubs === 0) recos.push("Renforcer le volume de publications (id√©alement ‚â• 3‚Äì5 articles index√©s).");
      else if (pubs < 5) recos.push("Poursuivre les publications dans des revues visibles pour consolider le profil acad√©mique.");
      if (awards === 0) recos.push("Identifier et documenter prix, bourses et distinctions.");
      if (!summary || summary.length < 200) recos.push("Clarifier le projet et l‚Äôimpact attendu (b√©n√©ficiaires, indicateurs mesurables).");
      if (score < 70) recos.push("Pr√©voir 12‚Äì18 mois d‚Äôactions de visibilit√© (publications, conf√©rences, collaborations).");
      if (recos.length === 0) recos.push("Profil structur√© ; travail strat√©gique fin n√©cessaire pour l‚Äôaligner sur les crit√®res formels.");
      return recos;
    }

    // Handler submit
    const form = document.getElementById("evaluationForm") || document.getElementById("eval-form");
    if (!form) {
      console.warn("Formulaire introuvable: v√©rifie l'id du formulaire dans public/evaluation-form.html");
      return;
    }

    form.addEventListener("submit", function (e) {
      e.preventDefault();

      // r√©cup√©ration des champs (soutient plusieurs noms si tu as des variantes)
      const get = (id) => {
        const el = document.getElementById(id);
        return el ? el.value : "";
      };

      // Try FormData fallback if fields are inputs without ids
      let fd = {};
      try {
        const fdata = new FormData(form);
        fd = Object.fromEntries(fdata.entries());
      } catch (err) {
        fd = {};
      }

      const program = get("program") || fd.program || "";
      const fullName = get("fullName") || fd.fullName || fd.fullName || fd.fullname || "";
      const email = get("email") || fd.email || "";
      const education = get("education") || fd.education || fd.level || "";
      const years = Number(get("years") || fd.years || fd.experience || 0);
      const country = get("country") || fd.country || "";
      const summary = get("summary") || fd.summary || fd.project || "";

      // metrics ‚Äî support noms 'pubs' ou 'publications', 'cites' ou 'citations'
      const pubs = Number(get("pubs") || get("publications") || fd.pubs || fd.publications || 0);
      const cites = Number(get("cites") || get("citations") || fd.cites || fd.citations || 0);
      const awards = Number(get("awards") || fd.awards || 0);

      const sector = get("sector") || fd.sector || "";
      const location = get("location") || get("place") || fd.location || fd.place || "";
      const projectDesc = get("project") || fd.project || "";

      // calculs
      const payloadForScore = {
        program, education, years, pubs, cites, awards, summary, projectDesc
      };
      const score = computeScore(payloadForScore);
      const programGuess = buildProgramGuess(score);
      const recommendations = buildRecommendations(payloadForScore, score);

      // payload (m√™me forme que EN)
      const payload = {
        score,
        programGuess,
        profile: {
          fullName: fullName,
          email: email,
          country: country,
          educationLevel: education,
          yearsExperience: years,
          summary: summary,
          targetProgram: program
        },
        metrics: {
          pubs: pubs,
          cites: cites,
          awards: awards
        },
        project: {
          sector: sector,
          place: location,
          summary: projectDesc
        },
        recommendations,
        lang: "fr"
      };

      try {
        localStorage.setItem("mba_eval_result_v1", JSON.stringify(payload));
        console.log("[EVAL-FR] Stored:", payload);
      } catch (err) {
        console.warn("Impossible d'√©crire dans localStorage:", err);
        alert("Impossible d'enregistrer localement ‚Äî v√©rifiez les param√®tres du navigateur.");
        return;
      }

      // redirection vers le rapport FR
      window.location.href = "evaluation-report.html";
    });
  })();
</script>
  </body>
</html>
